@page "/"
@using MudBlazor
@using PortOn.Shared.Models
@using System.Diagnostics
@inject HttpClient Http
@inject NavigationManager NavManager

<PageTitle>Dashboard</PageTitle>
<MudTimeline >
    <MudTimelineItem Color="Color.Inherit" Size="Size.Small">
        <ItemOpposite>
            <MudText Color="Color.Inherit" Typo="Typo.h5">2019</MudText>
        </ItemOpposite>
        <ItemContent>
            <MudText Color="Color.Inherit" Typo="Typo.h6" GutterBottom="true">Phoenixon Controls</MudText>
            <MudText>Construction of the town of Pripyat, one of 9 “atom towns” begins, to be inhabited by future employees of the nuclear power plants.</MudText>
        </ItemContent>
    </MudTimelineItem>
    <MudTimelineItem Color="Color.Inherit" Size="Size.Small">
        <ItemOpposite>
            <MudText Color="Color.Inherit" Typo="Typo.h5">2021</MudText>
        </ItemOpposite>
        <ItemContent>
            <MudText Color="Color.Inherit" Typo="Typo.h6" GutterBottom="true">J-One Soft</MudText>
            <MudText>The first of the Chernobyl Nuclear Power Plants four reactors is ready to operate followed by number 2 in 1978.</MudText>
        </ItemContent>
    </MudTimelineItem>
    <MudTimelineItem Color="Color.Inherit" Size="Size.Small">
        <ItemOpposite>
            <MudText Color="Color.Inherit" Typo="Typo.h5">2025</MudText>
        </ItemOpposite>
        <ItemContent>
            <MudText Color="Color.Inherit" Typo="Typo.h6" GutterBottom="true">Wavice</MudText>
            <MudText>Pripyat officially proclaimed as a city.<br />The Chernobyl Atomic Power Station reaches its first 10 billion kilowatt-hours of electical output.</MudText>
        </ItemContent>
    </MudTimelineItem>
</MudTimeline>

<MudDivider DividerType="DividerType.FullWidth" Class="my-6" />

<MudDataGrid T="DevelopmentProject" MultiSelection="true" Hover="true" Items="@projects" SortMode="SortMode.Multiple" Filterable="true"
Hideable="true">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Periodic Elements</MudText>
        <MudSpacer />
        <MudTextField @bind-Value="_searchString" Placeholder="Search" Adornment="Adornment.Start" Immediate="true"
        AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
    </ToolBarContent>
    <Columns>
        <SelectColumn T="DevelopmentProject" />
        <PropertyColumn Property="x => x.Name" />
        <PropertyColumn Property="x => x.Description" />
        <PropertyColumn Property="x => x.Company" />
        <PropertyColumn Property="x => x.StartDate" Format="yyyy-MM-dd" />
        <PropertyColumn Property="x => x.EndDate" Format="yyyy-MM-dd" />
        <PropertyColumn Property="x => x.Role" />
        <PropertyColumn Property="x => x.TechStack">
            <CellTemplate>
                @foreach (var tech in context.Item.TechStack)
                {
                    <code Class="docs-code">@tech </code>
                }
            </CellTemplate>
        </PropertyColumn>
    </Columns>
    <PagerContent>
        <MudDataGridPager T="DevelopmentProject" />
    </PagerContent>
</MudDataGrid>

<style>
    .docs-code {
    display: inline-block;
    padding: 0 5px;
    direction: ltr;
    font-size: .85em;
    font-weight: 900;
    font-family: Consolas,"Liberation Mono",Menlo,Courier,monospace;
    line-height: 1.4;
    border-radius: 2px;
    margin-right: 5px;
    background-color: var(--mud-palette-secondary-hover);
    -webkit-font-smoothing: subpixel-antialiased
    }

</style>

@code {
    private string _searchString;

    private List<DevelopmentProject> projects = new List<DevelopmentProject>();

    protected override async Task OnInitializedAsync()
    {
        // Uri uri = new Uri($"{NavManager.BaseUri}api/projects");

        try 
        {
            // await Task.Delay(1000);
             // string msg = await Http.GetStringAsync(uri);
             projects = await Http.GetFromJsonAsync<List<DevelopmentProject>>("/projects");
        }
        catch (Exception ex)
        {
            Debug.WriteLine(ex.Message);
        }
    }
}